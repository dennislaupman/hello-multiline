<!DOCTYPE html>
<html ng-app="helloMultiLine">
<head>
	<title>Hello... Realtime collaboration editor</title>

	<style type="text/css">

		body {
			margin: 0;
			padding: 0; 
		}

		[hello] {

			width: 550px;
			background: #ff00ff;
			padding: 10px;
			box-sizing: border-box;
			font-family: verdana;
			font-size: 14px;
			line-height: 24px;

		}

		[hello] div {

			background: #fff000;
		}
		
	</style>
</head>
<body  ng-controller="helloMultiLineCtrl">

	<div hello ng-click="selectRange()">

		<div>
			<div>Lorem Ipsum is slechts een proeftekst uit het drukkerij- en </div>
			<div>zetterijwezen. Lorem Ipsum is de standaard proeftekst in deze </div>
			<div>bedrijfstak sinds de 16e eeuw, toen een onbekende drukker een </div>
			<div>zethaak met letters nam en ze door elkaar husselde om een font-</div>
			<div>catalogus te maken. Het heeft niet alleen vijf eeuwen overleefd maar is </div>
			<div>ook, vrijwel onveranderd, overgenomen in elektronische letterzetting. </div>
			<div>Het is in de jaren '60 populair geworden met de introductie van Letraset </div>
			<div>vellen met Lorem Ipsum passages en meer recentelijk door desktop </div>
			<div>publishing software zoals Aldus PageMaker die versies van Lorem </div>
			<div>Ipsum bevatten.</div>
		</div>

	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>


	<script type="text/javascript">

		var getRowNumbers = function (startContainer, endContainer) {

			var counter = 0, start =0, end = 0;
			var container = document.querySelector( '[hello] div' );

			for (var i = 0; i <container.childNodes.length; i++) {

				//Skipt text nodes
				if(container.childNodes[i].nodeType === 3) {

					continue;
				}

				//Get start line
				if( container.childNodes[i] == startContainer.parentNode ) {

					start = counter;
				}
				//Get end line
				if( container.childNodes[i] == endContainer.parentNode ) {

					end = counter;
				}


				counter++;
			};

			return { start: start, end: end };
		}

		var app = angular.module('helloMultiLine', [])
  			app.controller('helloMultiLineCtrl', function( $scope, $timeout ) {

				$scope.selectRange = function( event ) {

					var selObj = window.getSelection();

					var startOffset = selObj.getRangeAt(0).startOffset;
					var endOffset = selObj.getRangeAt(0).endOffset;

					var startOffsetContainer = selObj.getRangeAt(0).startContainer;
					var endOffsetContainer = selObj.getRangeAt(0).endContainer;

					// console.log('startOffset', startOffset);
					// console.log('endOffset', endOffset);

					var lineNumbers = getRowNumbers(startOffsetContainer, endOffsetContainer);

					console.clear();
					console.log('startLine', lineNumbers.start);
					console.log('startOffset', startOffset);
					console.log('endLine', lineNumbers.end);
					console.log('endOffset', endOffset);
				}

			});

	</script>

</body>
</html>